<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.bookhub.product.mapper.BookMapper">

    <resultMap type="com.example.bookhub.product.vo.Book" id="BookDetailResultMap">
        <id column="book_no" property="bookNo"/>
        <result column="book_name" property="name"/>
        <result column="book_published_date" property="publishedDate"/>
        <result column="book_description" property="description"/>
        <result column="isbn" property="isbn"/>
        <result column="book_list_price" property="price"/>
        <result column="book_pages" property="pages"/>
        <result column="book_language" property="language"/>
        <result column="book_weight" property="weight"/>
        <result column="book_total_number" property="totalNumber"/>
        <result column="book_size" property="size"/>
        <result column="book_discontinuing_yn" property="discontinuingYn"/>
        <result column="book_discount_rate" property="discountRate"/>
        <result column="book_sales_volume" property="salesVolume"/>
        <association column="category_no" property="category"
                     select="com.example.bookhub.product.mapper.BookMapper.getCategoryByNo"/>
        <association column="publisher_no" property="publisher"
                     select="com.example.bookhub.product.mapper.BookMapper.getPublisherByNo"/>
    </resultMap>

    <resultMap type="com.example.bookhub.product.vo.Category" id="CategoryResultMap">
        <id column="category_no" property="categoryNo"/>
        <result column="category_name" property="name"/>
        <result column="parent_category_no" property="parentCategoryNo"/>
    </resultMap>

    <resultMap type="com.example.bookhub.product.vo.Publisher" id="PublisherResultMap">
        <id column="publisher_no" property="publisherNo"/>
        <result column="publisher_name" property="name"/>
    </resultMap>

    <select id="getCategoryByNo" parameterType="long" resultMap="CategoryResultMap">
        select
            CATEGORY_NO, CATEGORY_NAME, PARENT_CATEGORY_NO
        from
            CATEGORY
        where
            CATEGORY_NO = #{value}
    </select>

    <select id="getPublisherByNo" parameterType="long" resultMap="PublisherResultMap">
        select
            PUBLISHER_NO, PUBLISHER_NAME
        from
            PUBLISHER
        where
            PUBLISHER_NO = #{value}
    </select>

    <select id="getBookDetailByNo" parameterType="long" resultMap="BookDetailResultMap">
        select
            BOOK_NO,
            BOOK_NAME,
            BOOK_PUBLISHED_DATE,
            BOOK_DESCRIPTION,
            ISBN,
            BOOK_LIST_PRICE,
            PUBLISHER_NO,
            CATEGORY_NO,
            BOOK_PAGES,
            BOOK_LANGUAGE,
            BOOK_WEIGHT,
            BOOK_TOTAL_NUMBER,
            BOOK_SIZE,
            BOOK_DISCONTINUING_YN,
            BOOK_DISCOUNT_RATE,
            BOOK_SALES_VOLUME
        from
            BOOK B
        where
            BOOK_NO = #{value}
    </select>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.bookhub.product.mapper.BookMapper">

    <resultMap type="com.example.bookhub.product.dto.BookDto" id="BookDetailResultMap">
        <id column="book_no" property="bookNo"/>
        <result column="book_image_cover" property="imageCover"/>
        <result column="book_name" property="name"/>
        <result column="book_published_date" property="publishedDate"/>
        <result column="book_description" property="description"/>
        <result column="isbn" property="isbn"/>
        <result column="book_list_price" property="price"/>
        <result column="book_pages" property="pages"/>
        <result column="book_language" property="language"/>
        <result column="book_weight" property="weight"/>
        <result column="book_total_number" property="totalNumber"/>
        <result column="book_size" property="size"/>
        <result column="book_discontinuing_yn" property="discontinuingYn"/>
        <result column="book_discount_rate" property="discountRate"/>
        <result column="book_sales_volume" property="salesVolume"/>
        <result column="book_stock" property="stock"/>
        <result column="book_status" property="status"/>
        <association column="category_no" property="category"
                     select="com.example.bookhub.product.mapper.BookMapper.getCategoryByNo"/>
        <association column="publisher_no" property="publisher"
                     select="com.example.bookhub.product.mapper.BookMapper.getPublisherByNo"/>
    </resultMap>

    <resultMap type="com.example.bookhub.product.vo.BookImages" id="BookImagesResultMap">
        <id column="book_image_no" property="no"/>
        <result column="book_image_thumbnail" property="imageThumbnail"/>
        <result column="book_image_cover" property="imageCover"/>
        <result column="book_image_description" property="imageDescription"/>
    </resultMap>

    <resultMap type="com.example.bookhub.product.vo.Category" id="CategoryResultMap">
        <id column="category_no" property="categoryNo"/>
        <result column="category_name" property="name"/>
        <result column="parent_category_no" property="parentCategoryNo"/>
    </resultMap>

    <resultMap type="com.example.bookhub.product.vo.Publisher" id="PublisherResultMap">
        <id column="publisher_no" property="no"/>
        <result column="publisher_name" property="name"/>
    </resultMap>

    <select id="getCategoryByNo" parameterType="long" resultMap="CategoryResultMap">
        select
            CATEGORY_NO, CATEGORY_NAME, PARENT_CATEGORY_NO
        from
            CATEGORY
        where
            CATEGORY_NO = #{value}
    </select>

    <select id="getPublisherByNo" parameterType="long" resultMap="PublisherResultMap">
        select
            PUBLISHER_NO, PUBLISHER_NAME
        from
            PUBLISHER
        where
            PUBLISHER_NO = #{value}
    </select>

    <select id="getBookDetailByNo" parameterType="long" resultMap="BookDetailResultMap">
        select
            B.BOOK_NO,
            BI.BOOK_IMAGE_COVER,
            B.BOOK_NAME,
            B.BOOK_PUBLISHED_DATE,
            B.BOOK_DESCRIPTION,
            B.ISBN,
            B.BOOK_LIST_PRICE,
            B.PUBLISHER_NO,
            B.CATEGORY_NO,
            B.BOOK_PAGES,
            B.BOOK_LANGUAGE,
            B.BOOK_WEIGHT,
            B.BOOK_TOTAL_NUMBER,
            B.BOOK_SIZE,
            B.BOOK_DISCONTINUING_YN,
            B.BOOK_DISCOUNT_RATE,
            B.BOOK_SALES_VOLUME,
            B.BOOK_STOCK,
            B.BOOK_STATUS
        from
            BOOK B, BOOK_IMAGES BI
        where
            B.BOOK_NO = #{value}
            and B.BOOK_NO = BI.BOOK_NO
    </select>

    <select id="getBookByBookNo" parameterType="long" resultMap="BookDetailResultMap">
        select
            *
        from
            BOOK
        where
            book_no = #{bookNo}
        for update
    </select>

</mapper>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.bookhub.product.mapper.BuyMapper">

    <resultMap id="CouponListResultMap" type="com.example.bookhub.product.vo.CouponProduced">
        <id column="coupon_produced_no" property="couponProducedNo"/>
        <result column="due_date" property="dueDate"/>
        <association column="coupon_no" property="coupon"
                     select="com.example.bookhub.product.mapper.BuyMapper.getCouponByNo"/>
    </resultMap>

    <resultMap id="CouponResultMap" type="com.example.bookhub.product.vo.Coupon">
        <id column="coupon_no" property="couponNo"/>
        <result column="coupon_name" property="name"/>
        <result column="coupon_price" property="price"/>
    </resultMap>

    <select id="getBookNoByCartNo" parameterType="long" resultType="long">
        select book_no
        from CART
        where cart_no = #{value}
    </select>

    <select id="getCouponByNo" parameterType="long" resultMap="CouponResultMap">
        select
            coupon_no,
            coupon_name,
            coupon_price
        from
            COUPON
        where
            coupon_no = #{value}
    </select>

    <select id="getCouponsByUserNo" parameterType="long" resultMap="CouponListResultMap">
        select
            coupon_produced_no,
            due_date,
            coupon_no
        from
             COUPON_PRODUCED
        where
             user_no = #{value}
             and due_date >= sysdate()
             and used = 'N'
    </select>

</mapper>